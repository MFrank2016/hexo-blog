---
title: 《Java并发编程的艺术》读书笔记
tags: 
 - Java
 - 多线程
categories: 阅读
date: 2019-01-03 08:06:15
---
> 书籍作者：方腾飞 魏鹏 程晓明

## 第一章 并发编程的挑战

1.1 上下文切换

1. 时间片一般是几十毫秒。

```bash
疑问：时间片与CPU的哪个属性有关？
```

2. 任务从保存到再加载的过程就是一次上下文切换。

```bash
疑问：多个线程不没有产生竞争、阻塞或等待，也会发生上下文切换吗？
```

3. 使用`Lmbench3`可以测量上下文切换的时长。
4. 使用`vmstat`可以测量上下文切换的次数。
5. 减少上下文切换的方法：
   1. 无锁并发编程
   2. CAS算法
   3. 使用最少线程
   4. 协程

1.2 死锁

避免死锁的常见方法：

1. 避免一个线程同时获取多个锁。
2. 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源。
3. 尝试使用定时锁，使用`lock.tryLock(timeout)`来替代使用内部锁机制。
4. 对于数据库锁，加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况。

1.3 资源限制的挑战

1. 资源限制是指在进行并发编程时，程序的执行速度受限于计算机硬件资源或者软件资源。
2. 在并发编程中，将代码执行速度加快的原则是将代码中串行执行的部分变成并发执行，但是如果将某段串行的代码并发执行，因为受限于资源，仍然在串行执行，这时候程序不仅不会加快执行，反而会更慢，因为增加了上下文切换和资源调度的时间。
3. 对于硬件资源限制，可以考虑使用集群并行执行程序。对于软件资源限制，可以考虑使用资源池将资源进行复用。
   
## 第二章 Java并发机制的底层实现原理

2.1 volatile的应用

